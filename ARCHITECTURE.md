# Architecture

> Generated by /map on 2026-02-20

## Overview
Tabletop Time is a Next.js (App Router) web application designed for group event scheduling, specifically tailored for tabletop gaming communities but supporting generic uses (like Fantasy Drafts and Happy Hours). It utilizes a hybrid deployment model offering both a fully indexed "Hosted" AEO/SEO-optimized version and a privacy-first, unindexed "Self-Hosted" Docker mode.

## System Diagram
```ascii
[Client Browser] 
    | (Next.js App Router API Routes)
    v
[Next.js Server] ----> [Prisma ORM] ----> [Database (Hosted=Supabase/Self=SQLite)]
    |
    +---> [Telegram API Integration] (Webhooks / Polling)
    |
    +---> [Discord API Integration]
```

## Components

### App Router Layer (`app/`)
- **Purpose:** Defines the routing, pages, and API endpoints. Adheres to Next.js App Router conventions.
- **Location:** `app/`
- **Dependencies:** React, Next.js, Schema.org types (for AEO).
- **Dependents:** Clients making HTTP requests.

### Features Layer (`features/`)
- **Purpose:** Vertical grouping by business domain (e.g., `auth`, `discord`, `event-management`, `integrations`, `telegram`) adhering to Vertical Sliced Architecture.
- **Location:** `features/`
- **Dependencies:** Prisma, external APIs.
- **Dependents:** API Routes and Page definitions.

### Shared Layer (`shared/`)
- **Purpose:** Core shared utilities (e.g., AEO Schema generators, URL parsing, logging, Prisma client instance).
- **Location:** `shared/`
- **Dependencies:** General npm packages.
- **Dependents:** `features/`, `components/`, `app/`.

### Components Layer (`components/`)
- **Purpose:** Shared UI snippets and client components (e.g., `VotingInterface`, `TelegramConnect`, `DiscordConnect`).
- **Location:** `components/`
- **Dependencies:** React, TailwindCSS, lucide-react.
- **Dependents:** `app/` pages.

## Data Flow
1. Users visit the scheduling dashboard. They vote for time slots via `VotingInterface.tsx`.
2. The UI triggers a `POST` to `/api/event/[slug]/vote`.
3. The API validates the object, runs the `prisma` atomic transaction, and deletes/re-inserts proper votes.
4. Core logic fires notifications (via Telegram and Discord Webhooks) indicating updated availability.

## Integration Points
| External Service | Type | Purpose |
|------------------|------|---------|
| Telegram API | API | Event creation, vote notifications, and dashboard pinning in group chats. |
| Discord Webhooks | API | Replicates event dashboards and pinging inside target Discord channels. |
| Supabase | Database | Provides Postgres backend for the hosted version. |

## Conventions
- **Naming:** React components are `PascalCase.tsx`. Utilities and routes are `kebab-case` or `camelCase`.
- **Structure:** 
  - **Frontend:** Feature Sliced Design (FSD) enforcing discovery layers and separation by business domain.
  - **Backend:** Vertical Sliced Architecture (VSA).
- **Testing:** Uses `vitest` with setup scripts in `vitest.config.ts`.
- **AEO/SEO vs Privacy:** Deploys distinguish behaviour strictly. Hosted enforces heavy JSON-LD and Schema logic; Self-hosted enforces `noindex` and strict disallow.

## Technical Debt
- [ ] No major unresolved `TODO` or `FIXME` items identified.
